<!DOCTYPE html>

<html lang="en">
    <head>
        <title>CRYPTONOMICON</title>

        <meta charset="UTF-8" />

        <meta name="viewport" content="width=device-width,initial-scale=1" />

        <meta name="description" content="" />
    </head>

    <style>
        .card {
            width: 40px;
            height: 60px;
            border: 1px solid #151718;
            margin-right: 5px;
            margin-bottom: 5px;
            border-radius: 2px;
            float: left;
            font-family: courier;
            cursor: pointer;
        }

        .deck {
            overflow: hidden;
        }

        span.number,
        span.suit {
            width: 100%;
            display: block;
            text-align: center;
            padding-top: 8px;
        }
    </style>

    <script>
        function card(value, name, suit){
          this.value = value;
          this.name = name;
          this.suit = suit;
        }

        function deck(){
          this.names = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
          this.suits = ['Hearts','Diamonds','Spades','Clubs'];
          var cards = [];

            for( var s = 0; s < this.suits.length; s++ ) {
                for( var n = 0; n < this.names.length; n++ ) {
                    cards.push( new card( n+1, this.names[n], this.suits[s] ) );
                }
            }

        	cards.push(new card(53, 'A', 'Jokers'))
        	cards.push(new card(53, 'B', 'Jokers'))

            return cards;
        }
		
		var myDeck = new deck();


        function display(deck, div){
            div = document.createElement('div')
            div.className = 'deck'
            for(var i=0; i < deck.length; i++){
        		if(deck[i].suit == 'Diamonds'){
        		  var ascii_char = '&diams;';
        		}
        		else if (deck[i].suit == 'Jokers'){
        			var ascii_char = '&#9786;';
        		}
        		else {
        		  var ascii_char = '&' + deck[i].suit.toLowerCase() + ';';
        		}

        		div.innerHTML += '<div class="card">'+'<span class="number">' + deck[i].name + '</span><span class="suit">' + ascii_char + '</span>' + '</div>';
          }
          document.body.appendChild(div)
        }
		
		function titlePage(){
			document.body.innerHTML += '<h1>CRYPTONOMICON</h1>';
			document.body.innerHTML += '<button type="button" onclick="initialDeckPage();">NEXT</button>'

		}
		
		function initialDeckPage(){
			document.body.innerHTML = ""
			document.body.innerHTML += '<h1>MAKE INITIAL DECK</h1>';
			myDeck = shuffle(myDeck);
			display(myDeck);
			document.body.innerHTML += '<button type="button" onclick="moveJokersPage();">NEXT</button>'
		}
		
		function moveJokersPage(){
			/*

            Find the A joker. Move it one card down. (That is, swap it with the card beneath it.)
        	If the joker is the bottom card of the deck, move it just below the top card.

            Find the B joker. Move it two cards down.
        	If the joker is the bottom card of the deck, move it just below the second card.
        	If the joker is one up from the bottom card, move it just below the top card.
        	(Basically, assume the deck is a loop…you get the idea.)

            */
		  
			document.body.innerHTML = ""
			document.body.innerHTML += '<h1>MOVE JOKERS</h1>';
			
			display(myDeck)
			document.body.innerHTML += "-->"
			
			function moveDown(name, deck){
				  for(var i=0; i < deck.length; i++){
					if (deck[i].name == name){
						break;
					}
				  }
				  
				  deck.splice((i+2)%deck.length, 0, deck[i]);
				  deck.splice(i, 1);
			  }
			  
			  moveDown('A', myDeck)
			  moveDown('B', myDeck)
			  moveDown('B', myDeck)
			  
			  display(myDeck)
			  
			  document.body.innerHTML += '<button type="button" onclick="tripleCutPage();">NEXT</button>'
			
		}
		
		function tripleCutPage(){
			/*
			Perform a triple cut. 
		    That is, swap the cards above the first joker with the cards below the second joker.
		    “First” and “second” jokers refer to whatever joker is nearest to, and furthest from, the top of the deck.
		    Ignore the “A” and “B” designations for this step.
		    */
			
			document.body.innerHTML = ""
			document.body.innerHTML += '<h1>TRIPLE CUT</h1>';
			
			function tripleSwap(deck){
				for(var i=0; i < deck.length; i++){
					if (deck[i].suit == 'Jokers'){
						var i1 = i;
						break;
					}
				  }
				for(var j=i+1; j < deck.length; j++){
					if (deck[j].suit == 'Jokers'){
						var i2 = j;
						break;
					}
				  }
				return [...deck.slice(i2+1, deck.length), ...deck.slice(i1,i2+1), ...deck.slice(0, i1)]
		    }
			
			display(myDeck)
			document.body.innerHTML += "-->"
			myDeck = tripleSwap(myDeck);
			display(myDeck)
			
			document.body.innerHTML += '<button type="button" onclick="countCutPage();">NEXT</button>'
		}
		
		function countCutPage(){
			/*
			Perform a count cut. 
			Look at the bottom card.
			Convert it into a number from 1 through 53.
			(Use the bridge order of suits: clubs, diamonds, hearts, and spades.
			If the card is a club, it is the value shown.
			If the card is a diamond, it is the value plus 13.
			If it is a heart, it is the value plus 26.
			If it is a spade, it is the value plus 39.
			Either joker is a 53.)
			Count down from the top card that number.
			(I generally count 1 through 13 again and again if I have to; it’s easier than counting to high numbers sequentially.)
			Cut after the card that you counted down to, leaving the bottom card on the bottom.
			*/
			
			document.body.innerHTML = ""
			document.body.innerHTML += "<h1>COUNT CUT</h1>"
			
			function countCut(deck){
				function cardToNum(card){
					if (card.suit == "Clubs"){
						return card.value;
					}
					else if (card.suit == "Diamonds"){
						return card.value + 13;
					}
					else if (card.suit == "Hearts"){
						return card.value + 26;
					}
					else if (card.suit == "Spades"){
						return card.value + 39;
					}
					else if (card.suit == "Jokers"){
						return 53;
					}
				}
			
				n = cardToNum(deck[deck.length-1])
				return [...deck.slice(n, deck.length-1), ...deck.slice(0,n), deck[deck.length-1]]
			}
		  
			display(myDeck)
			document.body.innerHTML += "-->"
			myDeck = countCut(myDeck)
			display(myDeck)
			
			document.body.innerHTML += '<button type="button" onclick="countCutPage();">NEXT</button>'
			
		}

        window.onload = titlePage;
		
        function shuffle(o) {
          for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
          return o;
        };
    </script>

    <body></body>
</html>
